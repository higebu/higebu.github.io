<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>VyOS で Docker を動かす - higeblog</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link href="https://www.higebu.com/images/favicon.ico" rel="icon">

    <!-- Open Graph tags -->
            <meta property="og:type" content="article"/>
            <meta property="og:title" content="VyOS で Docker を動かす"/>
            <meta property="og:url" content="https://www.higebu.com/blog/2014/12/10/docker-on-vyos/"/>
            <meta property="og:description" content="VyOS で Docker を動かす方法です。"/>

    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://www.higebu.com/theme/css/bootstrap.cosmo.min.css" type="text/css"/>
    <link href="https://www.higebu.com/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://www.higebu.com/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="https://www.higebu.com/theme/css/style.css" type="text/css"/>

        <link href="https://www.higebu.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="higeblog ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://www.higebu.com/" class="navbar-brand">
higeblog            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li class="active">
                            <a href="https://www.higebu.com/category/tech.html">Tech</a>
                        </li>
                        <li >
                            <a href="https://www.higebu.com/category/road-bike.html">Road bike</a>
                        </li>
                        <li >
                            <a href="https://www.higebu.com/category/lifetech.html">Life,tech</a>
                        </li>
                        <li >
                            <a href="https://www.higebu.com/category/life.html">Life</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="https://www.higebu.com/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
                <li><a href="https://travis-ci.org/higebu/higebu.github.io"><img src="https://travis-ci.org/higebu/higebu.github.io.svg?branch=source" alt="Build Status" style="max-width:100%;"></a></li>
                <li><a href="https://validator.w3.org/feed/check.cgi?url=https%3A//www.higebu.com/feeds/all.atom.xml"><img src="https://validator.w3.org/feed/images/valid-atom.png" alt="[Valid Atom 1.0]" style="max-width:80%;"></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-sm-9">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://www.higebu.com/blog/2014/12/10/docker-on-vyos/"
                       rel="bookmark"
                       title="Permalink to VyOS で Docker を動かす">
                        VyOS で Docker を動かす
                    </a><a href="https://b.hatena.ne.jp/entry/https://www.higebu.com/blog/2014/12/10/docker-on-vyos/"><img src="https://b.hatena.ne.jp/entry/image/large/https://www.higebu.com/blog/2014/12/10/docker-on-vyos/"></a><a href="https://b.hatena.ne.jp/entry/http://www.higebu.com/blog/2014/12/10/docker-on-vyos/"><img src="https://b.hatena.ne.jp/entry/image/large/http://www.higebu.com/blog/2014/12/10/docker-on-vyos/"></a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2014-12-10T23:30:00+09:00"> Wed 10 December 2014</time>
    </span>



<span class="label label-default">Tags</span>
	<a href="https://www.higebu.com/tag/vyos.html">vyos</a>
        /
	<a href="https://www.higebu.com/tag/docker.html">docker</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>この記事は、 <a href="http://qiita.com/advent-calendar/2014/vyos">VyOS Advent Calendar 2014</a> の10日目の記事です。</p>
<div class="toc">
<ul>
<li><a href="#_1">作り方</a></li>
<li><a href="#_2">使い方</a></li>
</ul>
</div>
<h2 id="_1">作り方</h2>
<p>VyOS は AUFS が入っていないので、カーネルからビルドし直します。</p>
<p>普通に入れようとすると <code>FATAL: Module aufs not found.</code> と怒られます。</p>
<p>AUFS に対応させる手順は下記の通りです。</p>
<p>まず、 <code>vyos-kernel</code> を <code>git clone</code> します。</p>
<div class="highlight"><pre><span></span><span class="err">git clone git@github.com:vyos/vyos-kernel.git</span>
</pre></div>


<p>ここで、 <code>vyos-kernel</code> に適当なブランチを作っておきます。</p>
<p><code>aufs3-standalone</code> のソースを持ってきてパッチを当てます。</p>
<div class="highlight"><pre><span></span><span class="err">git clone git://aufs.git.sourceforge.net/gitroot/aufs/aufs3-standalone.git</span>
<span class="err">pushd aufs3-standalone</span>
<span class="err">git checkout origin/aufs3.13</span>
<span class="err">popd</span>
<span class="err">cp -r aufs3-standalone/{Documentation,fs} vyos-kernel</span>
<span class="err">cp aufs3-standalone/include/uapi/linux/aufs_type.h vyos-kernel/include/uapi/linux/aufs_type.h</span>
<span class="err">cd vyos-kernel</span>
<span class="err">cat ../aufs3-standalone/aufs3-{base,kbuild,loopback,mmap,standalone}.patch | patch -p1</span>
</pre></div>


<p>また、 cgroup のオプションが足りないので、足します。</p>
<p>AUFS を足しただけだと、下記のようになります。</p>
<div class="highlight"><pre><span></span><span class="err">vyos@vyos:~$ docker info</span>
<span class="c">Containers: 0</span>
<span class="c">Images: 7</span>
<span class="err">Storage Driver: aufs</span>
<span class="err"> Root Dir: /var/lib/docker/aufs</span>
<span class="err"> Dirs: 7</span>
<span class="err">Execution Driver: native-0.2</span>
<span class="err">Kernel Version: 3.13.11-1-amd64-vyos</span>
<span class="err">Operating System: &lt;unknown&gt;</span>
<span class="c">WARNING: No memory limit support</span>
<span class="c">WARNING: No swap limit support</span>
</pre></div>


<p>config の diff は最終的に下記のようになりました。</p>
<div class="highlight"><pre><span></span><span class="o">#</span> <span class="n">git</span> <span class="n">diff</span> <span class="n">HEAD</span><span class="o">^</span> <span class="n">debian</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">amd64</span><span class="o">/</span><span class="n">config</span><span class="p">.</span><span class="n">amd64</span><span class="o">-</span><span class="n">vyos</span> <span class="o">|</span> <span class="n">cat</span> <span class="o">-</span>
<span class="n">diff</span> <span class="c1">--git a/debian/arch/amd64/config.amd64-vyos b/debian/arch/amd64/config.amd64-vyos</span>
<span class="k">index</span> <span class="mi">609</span><span class="n">abec</span><span class="p">..</span><span class="mi">570</span><span class="n">c4a2</span> <span class="mi">100644</span>
<span class="c1">--- a/debian/arch/amd64/config.amd64-vyos</span>
<span class="o">+++</span> <span class="n">b</span><span class="o">/</span><span class="n">debian</span><span class="o">/</span><span class="n">arch</span><span class="o">/</span><span class="n">amd64</span><span class="o">/</span><span class="n">config</span><span class="p">.</span><span class="n">amd64</span><span class="o">-</span><span class="n">vyos</span>
<span class="o">@@</span> <span class="o">-</span><span class="mi">141</span><span class="p">,</span><span class="mi">18</span> <span class="o">+</span><span class="mi">141</span><span class="p">,</span><span class="mi">26</span> <span class="o">@@</span> <span class="n">CONFIG_ARCH_WANTS_PROT_NUMA_PROT_NONE</span><span class="o">=</span><span class="n">y</span>
 <span class="o">#</span> <span class="n">CONFIG_NUMA_BALANCING</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>
 <span class="n">CONFIG_CGROUPS</span><span class="o">=</span><span class="n">y</span>
 <span class="o">#</span> <span class="n">CONFIG_CGROUP_DEBUG</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>
<span class="o">-#</span> <span class="n">CONFIG_CGROUP_FREEZER</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>
<span class="o">-#</span> <span class="n">CONFIG_CGROUP_DEVICE</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>
<span class="o">+</span><span class="n">CONFIG_CGROUP_FREEZER</span><span class="o">=</span><span class="n">y</span>
<span class="o">+</span><span class="n">CONFIG_CGROUP_DEVICE</span><span class="o">=</span><span class="n">y</span>
 <span class="n">CONFIG_CPUSETS</span><span class="o">=</span><span class="n">y</span>
 <span class="n">CONFIG_PROC_PID_CPUSET</span><span class="o">=</span><span class="n">y</span>
<span class="o">-#</span> <span class="n">CONFIG_CGROUP_CPUACCT</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>
<span class="o">-#</span> <span class="n">CONFIG_RESOURCE_COUNTERS</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>
<span class="o">-#</span> <span class="n">CONFIG_CGROUP_PERF</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>
<span class="o">+</span><span class="n">CONFIG_CGROUP_CPUACCT</span><span class="o">=</span><span class="n">y</span>
<span class="o">+</span><span class="n">CONFIG_RESOURCE_COUNTERS</span><span class="o">=</span><span class="n">y</span>
<span class="o">+</span><span class="n">CONFIG_MEMCG</span><span class="o">=</span><span class="n">y</span>
<span class="o">+</span><span class="n">CONFIG_MEMCG_SWAP</span><span class="o">=</span><span class="n">y</span>
<span class="o">+</span><span class="n">CONFIG_MEMCG_SWAP_ENABLED</span><span class="o">=</span><span class="n">y</span>
<span class="o">+</span><span class="n">CONFIG_CGROUP_MEM_RES_CTLR_SWAP</span><span class="o">=</span><span class="n">y</span>
<span class="o">+</span><span class="n">CONFIG_CGROUP_MEM_RES_CTLR_SWAP_ENABLED</span><span class="o">=</span><span class="n">y</span>
<span class="o">+</span><span class="n">CONFIG_MEMCG_KMEM</span><span class="o">=</span><span class="n">y</span>
<span class="o">+</span><span class="n">CONFIG_CGROUP_HUGETLB</span><span class="o">=</span><span class="n">y</span>
<span class="o">+</span><span class="n">CONFIG_CGROUP_PERF</span><span class="o">=</span><span class="n">y</span>
 <span class="n">CONFIG_CGROUP_SCHED</span><span class="o">=</span><span class="n">y</span>
 <span class="n">CONFIG_FAIR_GROUP_SCHED</span><span class="o">=</span><span class="n">y</span>
<span class="o">-#</span> <span class="n">CONFIG_CFS_BANDWIDTH</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>
<span class="o">-</span><span class="n">CONFIG_RT_GROUP_SCHED</span><span class="o">=</span><span class="n">y</span>
<span class="o">-#</span> <span class="n">CONFIG_BLK_CGROUP</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>
<span class="o">+</span><span class="n">CONFIG_CFS_BANDWIDTH</span><span class="o">=</span><span class="n">y</span>
<span class="o">+#</span> <span class="n">CONFIG_RT_GROUP_SCHED</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>
<span class="o">+</span><span class="n">CONFIG_BLK_CGROUP</span><span class="o">=</span><span class="n">y</span>
<span class="o">+#</span> <span class="n">CONFIG_DEBUG_BLK_CGROUP</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>
 <span class="o">#</span> <span class="n">CONFIG_CHECKPOINT_RESTORE</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>
 <span class="n">CONFIG_NAMESPACES</span><span class="o">=</span><span class="n">y</span>
 <span class="n">CONFIG_UTS_NS</span><span class="o">=</span><span class="n">y</span>
<span class="o">@@</span> <span class="o">-</span><span class="mi">273</span><span class="p">,</span><span class="mi">6</span> <span class="o">+</span><span class="mi">281</span><span class="p">,</span><span class="mi">7</span> <span class="o">@@</span> <span class="n">CONFIG_BLOCK</span><span class="o">=</span><span class="n">y</span>
 <span class="n">CONFIG_BLK_DEV_BSG</span><span class="o">=</span><span class="n">y</span>
 <span class="n">CONFIG_BLK_DEV_BSGLIB</span><span class="o">=</span><span class="n">y</span>
 <span class="n">CONFIG_BLK_DEV_INTEGRITY</span><span class="o">=</span><span class="n">y</span>
<span class="o">+</span><span class="n">CONFIG_BLK_DEV_THROTTLING</span><span class="o">=</span><span class="n">y</span>
 <span class="o">#</span> <span class="n">CONFIG_BLK_CMDLINE_PARSER</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>

 <span class="o">#</span>
<span class="o">@@</span> <span class="o">-</span><span class="mi">307</span><span class="p">,</span><span class="mi">6</span> <span class="o">+</span><span class="mi">316</span><span class="p">,</span><span class="mi">7</span> <span class="o">@@</span> <span class="n">CONFIG_BLOCK_COMPAT</span><span class="o">=</span><span class="n">y</span>
 <span class="n">CONFIG_IOSCHED_NOOP</span><span class="o">=</span><span class="n">y</span>
 <span class="n">CONFIG_IOSCHED_DEADLINE</span><span class="o">=</span><span class="n">y</span>
 <span class="n">CONFIG_IOSCHED_CFQ</span><span class="o">=</span><span class="n">y</span>
<span class="o">+</span><span class="n">CONFIG_CFQ_GROUP_IOSCHED</span><span class="o">=</span><span class="n">y</span>
 <span class="o">#</span> <span class="n">CONFIG_DEFAULT_DEADLINE</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>
 <span class="n">CONFIG_DEFAULT_CFQ</span><span class="o">=</span><span class="n">y</span>
 <span class="o">#</span> <span class="n">CONFIG_DEFAULT_NOOP</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>
<span class="o">@@</span> <span class="o">-</span><span class="mi">4007</span><span class="p">,</span><span class="mi">6</span> <span class="o">+</span><span class="mi">4017</span><span class="p">,</span><span class="mi">30</span> <span class="o">@@</span> <span class="n">CONFIG_CLKBLD_I8253</span><span class="o">=</span><span class="n">y</span>
 <span class="o">#</span> <span class="n">CONFIG_POWERCAP</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>

 <span class="o">#</span>
<span class="o">+#</span> <span class="n">AUFS</span> <span class="n">Support</span>
<span class="o">+#</span>
<span class="o">+</span><span class="n">CONFIG_AUFS_FS</span><span class="o">=</span><span class="n">m</span>
<span class="o">+</span><span class="n">CONFIG_AUFS_BRANCH_MAX_127</span><span class="o">=</span><span class="n">y</span>
<span class="o">+#</span> <span class="n">CONFIG_AUFS_BRANCH_MAX_511</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>
<span class="o">+#</span> <span class="n">CONFIG_AUFS_BRANCH_MAX_1023</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>
<span class="o">+#</span> <span class="n">CONFIG_AUFS_BRANCH_MAX_32767</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>
<span class="o">+</span><span class="n">CONFIG_AUFS_SBILIST</span><span class="o">=</span><span class="n">y</span>
<span class="o">+#</span> <span class="n">CONFIG_AUFS_HNOTIFY</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>
<span class="o">+</span><span class="n">CONFIG_AUFS_EXPORT</span><span class="o">=</span><span class="n">y</span>
<span class="o">+</span><span class="n">CONFIG_AUFS_XATTR</span><span class="o">=</span><span class="n">y</span>
<span class="o">+#</span> <span class="n">CONFIG_AUFS_FHSM</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>
<span class="o">+#</span> <span class="n">CONFIG_AUFS_RDU</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>
<span class="o">+#</span> <span class="n">CONFIG_AUFS_SHWH</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>
<span class="o">+</span><span class="n">CONFIG_AUFS_BR_RAMFS</span><span class="o">=</span><span class="n">y</span>
<span class="o">+</span><span class="n">CONFIG_AUFS_BR_FUSE</span><span class="o">=</span><span class="n">y</span>
<span class="o">+</span><span class="n">CONFIG_AUFS_BR_HFSPLUS</span><span class="o">=</span><span class="n">y</span>
<span class="o">+#</span> <span class="n">CONFIG_AUFS_DEBUG</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>
<span class="o">+#</span> <span class="n">CONFIG_AUFS_MAGIC_SYSRQ</span> <span class="k">is</span> <span class="k">not</span> <span class="k">set</span>
<span class="o">+</span><span class="n">CONFIG_AUFS_BDEV_LOOP</span><span class="o">=</span><span class="n">y</span>
<span class="o">+</span><span class="n">CONFIG_AUFS_INO_T_64</span><span class="o">=</span><span class="n">y</span>
<span class="o">+</span><span class="n">CONFIG_AUFS_POLL</span><span class="o">=</span><span class="n">y</span>
<span class="o">+</span>
<span class="o">+#</span>
 <span class="o">#</span> <span class="n">Firmware</span> <span class="n">Drivers</span>
 <span class="o">#</span>
 <span class="n">CONFIG_EDD</span><span class="o">=</span><span class="n">m</span>
</pre></div>


<p>修正した <code>vyos-kernel</code> は <a href="https://github.com/higebu/vyos-kernel/tree/helium-docker">GitHub</a> に置いてあります。</p>
<p>ビルドの仕方は、昨日と同じで、シェルスクリプトにしてあって、 <a href="https://gist.github.com/higebu/409c00db4aa1256e405b">gist</a> に置いてあります。</p>
<p><a href="https://twitter.com/hiroysato">hiroysato</a> さんの <a href="https://gist.github.com/hiroyuki-sato/201032fe75d2cf9f5801">Jessie 上で VyOS をビルドする手順</a>を参考に Wheezy でビルドしました。</p>
<p>興味のある方は読んでみてください。</p>
<h2 id="_2">使い方</h2>
<p>ISO をダウンロードし、インストールします。</p>
<p>ビルド済みの ISO は <a href="https://github.com/higebu/build-iso/releases/download/vyos%2F1.1.1-docker/VyOS-livecd-1412091651-cff5913-amd64.iso">GitHub</a> に置いてあります。</p>
<p>起動して、<code>show version</code> すると下記のように表示されます。</p>
<div class="highlight"><pre><span></span><span class="err">vyos@vyos:~$ show version</span>
<span class="c">Version:      VyOS 999.heliumdocker.12091651</span>
<span class="c">Description:  999.heliumdocker.12091651</span>
<span class="c">Copyright:    2014 VyOS maintainers and contributors</span>
<span class="err">Built by:     root@contributors.vyos.net</span>
<span class="err">Built on:     Tue Dec  9 16:51:21 UTC 2014</span>
<span class="err">Build ID:     1412091651-cff5913</span>
<span class="err">System type:  x86 64-bit</span>
<span class="err">Boot via:     disk</span>
<span class="c">Hypervisor:   VMware</span>
<span class="err">HW model:     VMware Virtual Platform</span>
<span class="err">HW S/N:       VMware-42 02 fc 13 49 8a c7 0f-e6 f2 dc 16 0c 81 91 12</span>
<span class="err">HW UUID:      4202FC13-498A-C70F-E6F2-DC160C819112</span>
<span class="c">Uptime:       15:29:54 up 3 min,  1 user,  load average: 0.01, 0.03, 0.02</span>
</pre></div>


<p>Docker をインストールします。</p>
<div class="highlight"><pre><span></span><span class="err">configure</span>
<span class="err">set system package repository squeeze url http://ftp.jp.debian.org/debian/</span>
<span class="err">set system package repository squeeze distribution squeeze</span>
<span class="err">set system package repository squeeze components &#39;main contrib non-free&#39;</span>
<span class="err">set system package repository squeeze-lts url http://ftp.jp.debian.org/debian/</span>
<span class="err">set system package repository squeeze-lts distribution squeeze-lts</span>
<span class="err">set system package repository squeeze-lts components &#39;main contrib non-free&#39;</span>
<span class="err">commit</span>
<span class="err">save</span>
<span class="err">exit</span>
<span class="err">sudo apt-get update</span>
<span class="err">curl -sSL https://get.docker.com/ | /bin/sh</span>
</pre></div>


<p>vyos ユーザを docker グループに所属させます。</p>
<div class="highlight"><pre><span></span><span class="err">sudo usermod -aG docker vyos</span>
</pre></div>


<p>ログアウト、ログインします。</p>
<p><code>start-stop-daemon</code> が古く、 <code>--no-close</code> に対応していないので、 <code>/etc/init.d/docker</code> から消します。</p>
<div class="highlight"><pre><span></span><span class="err">sudo sed -i &#39;/--no-close/d&#39; /etc/init.d/docker</span>
</pre></div>


<p>Docker を起動します。</p>
<div class="highlight"><pre><span></span><span class="err">sudo /etc/init.d/docker start</span>
</pre></div>


<p><code>docker info</code> を見てみます。</p>
<div class="highlight"><pre><span></span><span class="err">vyos@vyos:~$ docker info</span>
<span class="c">Containers: 0</span>
<span class="c">Images: 0</span>
<span class="err">Storage Driver: aufs</span>
<span class="err"> Root Dir: /var/lib/docker/aufs</span>
<span class="err"> Dirs: 0</span>
<span class="err">Execution Driver: native-0.2</span>
<span class="err">Kernel Version: 3.13.11-1-amd64-vyos</span>
<span class="err">Operating System: &lt;unknown&gt;</span>
</pre></div>


<p>WARNING は出ていません！</p>
<p>Operating System が <code>&lt;unknown&gt;</code> ですが気にしないことにして、 VyOS の Docker イメージを起動してみます。</p>
<div class="highlight"><pre><span></span><span class="err">vyos@vyos:~$ docker run -d --privileged -v /lib/modules:/lib/modules -v /boot:/boot higebu/vyos:latest /sbin/init</span>
<span class="err">01f328b0b8dbf763a1aada80e85980577146be377c4ea4d284583f02b8c44355</span>
<span class="err">vyos@vyos:~$ docker ps -l</span>
<span class="err">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span>
<span class="err">01f328b0b8db        higebu/vyos:1.1.1   &quot;/sbin/init&quot;        4 seconds ago       Up 3 seconds                            suspicious_morse</span>
</pre></div>


<p>中に入ってみます。</p>
<div class="highlight"><pre><span></span><span class="err">vyos@vyos:~$ docker exec -ti suspicious_morse /bin/vbash</span>
<span class="err">vbash-4.1# su - vyos</span>
<span class="err">vyos@vyos:~$ show version</span>
<span class="c">WARNING: terminal is not fully functional</span>
<span class="c">Version:      VyOS 1.1.1</span>
<span class="c">Description:  VyOS 1.1.1 (helium)</span>
<span class="c">Copyright:    2014 VyOS maintainers and contributors</span>
<span class="err">Built by:     maintainers@vyos.net</span>
<span class="err">Built on:     Sun Dec  7 21:41:28 UTC 2014</span>
<span class="err">Build ID:     1412072141-129950d</span>
<span class="err">System type:  x86 64-bit</span>
<span class="err">Boot via:     disk</span>
<span class="c">Hypervisor:   VMware</span>
<span class="err">HW model:     VMware Virtual Platform</span>
<span class="err">HW S/N:       VMware-42 02 fc 13 49 8a c7 0f-e6 f2 dc 16 0c 81 91 12</span>
<span class="err">HW UUID:      4202FC13-498A-C70F-E6F2-DC160C819112</span>
<span class="c">Uptime:       06:47:14 up 21 min,  0 users,  load average: 0.03, 0.05, 0.05</span>
</pre></div>


<p>一応動いていますね。</p>
<p>しかし、 VyOS の Docker イメージがおかしいようで、 IP アドレスが付きません。</p>
<div class="highlight"><pre><span></span><span class="err">vbash-4.1# ip a</span>
<span class="c">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default </span>
<span class="c">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span>
<span class="c">    inet 127.0.0.1/8 scope host lo</span>
<span class="c">       valid_lft forever preferred_lft forever</span>
<span class="c">    inet6 ::1/128 scope host </span>
<span class="c">       valid_lft forever preferred_lft forever</span>
<span class="c">6: eth0: &lt;BROADCAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span>
<span class="c">    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff</span>
<span class="c">    inet6 fe80::42:acff:fe11:3/64 scope link </span>
<span class="c">       valid_lft forever preferred_lft forever</span>
</pre></div>


<p>下記のように <code>debian:latest</code> のイメージを取ってきて動かすと IP アドレスが付いているので、 VyOS 上で Docker を動かすという部分については、今のところ問題ないと思っています。</p>
<div class="highlight"><pre><span></span><span class="n">vyos</span><span class="p">@</span><span class="nl">vyos</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> <span class="nl">debian</span><span class="p">:</span><span class="n">latest</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>
<span class="n">Unable</span> <span class="n">to</span> <span class="n">find</span> <span class="n">image</span> <span class="err">&#39;</span><span class="nl">debian</span><span class="p">:</span><span class="n">latest</span><span class="err">&#39;</span> <span class="n">locally</span>
<span class="nl">debian</span><span class="p">:</span><span class="nl">latest</span><span class="p">:</span> <span class="n">The</span> <span class="n">image</span> <span class="n">you</span> <span class="n">are</span> <span class="n">pulling</span> <span class="n">has</span> <span class="n">been</span> <span class="n">verified</span>
<span class="mi">511136</span><span class="nl">ea3c5a</span><span class="p">:</span> <span class="n">Pull</span> <span class="n">complete</span> 
<span class="nl">f10807909bc5</span><span class="p">:</span> <span class="n">Pull</span> <span class="n">complete</span> 
<span class="nl">f6fab3b798be</span><span class="p">:</span> <span class="n">Pull</span> <span class="n">complete</span> 
<span class="nl">Status</span><span class="p">:</span> <span class="n">Downloaded</span> <span class="n">newer</span> <span class="n">image</span> <span class="k">for</span> <span class="nl">debian</span><span class="p">:</span><span class="n">latest</span>
<span class="n">root</span><span class="mf">@2e86576</span><span class="nl">d3b90</span><span class="p">:</span><span class="o">/</span><span class="err">#</span> 
<span class="n">root</span><span class="mf">@2e86576</span><span class="nl">d3b90</span><span class="p">:</span><span class="o">/</span><span class="err">#</span> 
<span class="n">root</span><span class="mf">@2e86576</span><span class="nl">d3b90</span><span class="p">:</span><span class="o">/</span><span class="err">#</span> <span class="n">ip</span> <span class="n">a</span>
<span class="mi">1</span><span class="o">:</span> <span class="nl">lo</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">LOOPBACK</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">65536</span> <span class="n">qdisc</span> <span class="n">noqueue</span> <span class="n">state</span> <span class="n">UNKNOWN</span> 
    <span class="n">link</span><span class="o">/</span><span class="n">loopback</span> <span class="mo">00</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span> <span class="n">brd</span> <span class="mo">00</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span>
    <span class="n">inet</span> <span class="mf">127.0.0.1</span><span class="o">/</span><span class="mi">8</span> <span class="n">scope</span> <span class="n">host</span> <span class="n">lo</span>
       <span class="n">valid_lft</span> <span class="n">forever</span> <span class="n">preferred_lft</span> <span class="n">forever</span>
    <span class="n">inet6</span> <span class="o">::</span><span class="mi">1</span><span class="o">/</span><span class="mi">128</span> <span class="n">scope</span> <span class="n">host</span> 
       <span class="n">valid_lft</span> <span class="n">forever</span> <span class="n">preferred_lft</span> <span class="n">forever</span>
<span class="mi">4</span><span class="o">:</span> <span class="nl">eth0</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span> <span class="n">mtu</span> <span class="mi">1500</span> <span class="n">qdisc</span> <span class="n">pfifo_fast</span> <span class="n">state</span> <span class="n">UP</span> <span class="n">qlen</span> <span class="mi">1000</span>
    <span class="n">link</span><span class="o">/</span><span class="n">ether</span> <span class="mo">02</span><span class="o">:</span><span class="mi">42</span><span class="o">:</span><span class="nl">ac</span><span class="p">:</span><span class="mi">11</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mo">02</span> <span class="n">brd</span> <span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="n">ff</span>
    <span class="n">inet</span> <span class="mf">172.17.0.2</span><span class="o">/</span><span class="mi">16</span> <span class="n">scope</span> <span class="n">global</span> <span class="n">eth0</span>
       <span class="n">valid_lft</span> <span class="n">forever</span> <span class="n">preferred_lft</span> <span class="n">forever</span>
    <span class="n">inet6</span> <span class="n">fe80</span><span class="o">::</span><span class="mi">42</span><span class="o">:</span><span class="nl">acff</span><span class="p">:</span><span class="nl">fe11</span><span class="p">:</span><span class="mi">2</span><span class="o">/</span><span class="mi">64</span> <span class="n">scope</span> <span class="n">link</span> 
       <span class="n">valid_lft</span> <span class="n">forever</span> <span class="n">preferred_lft</span> <span class="n">forever</span>
</pre></div>


<p>VyOS の Docker イメージを直すことができたら、またブログに書きたいと思います。</p>
<p>以上です。</p>
            </div>
            <!-- /.entry-content -->
    <hr />
    <!-- AddThis Button BEGIN -->
    <div class="addthis_toolbox addthis_default_style">
        <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
        <a class="addthis_button_tweet"></a>
        <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
        <a href="http://b.hatena.ne.jp/entry/https://www.higebu.com/blog/2014/12/10/docker-on-vyos/" class="hatena-bookmark-button" data-hatena-bookmark-title="VyOS で Docker を動かす" data-hatena-bookmark-layout="simple-balloon" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
    </div>
    <script type="text/javascript">var addthis_config = {"data_track_addressbar": true};</script>
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-53123bf42910d399"></script>
    <!-- AddThis Button END -->
    <hr />
    <section class="comments" id="comments">
        <h2>Comments</h2>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'higeblog'; // required: replace example with your forum shortname
            var disqus_url = 'https://www.higebu.com/blog/2014/12/10/docker-on-vyos/';
            var disqus_config = function () {
                this.language = "ja";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

    <!-- HatenaStar -->
    <script type="text/javascript" src="https://s.hatena.ne.jp/js/HatenaStar.js"></script>
    <script type="text/javascript">
    Hatena.Star.SiteConfig = {
      entryNodes: {
        'header.page-header': {
          uri: 'h1 a',
          title: 'h1',
          container: 'h1'
        }
      }
    };
    </script>

        </div>
        <div class="col-sm-3 well well-sm" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
                  <ul class="list-group" id="social">
                    <li class="list-group-item"><a href="http://twitter.com/higebu"><i
                            class="fa fa-twitter-square fa-lg"></i> twitter
                    </a></li>
                    <li class="list-group-item"><a href="http://www.facebook.com/higebu"><i
                            class="fa fa-facebook-square fa-lg"></i> facebook
                    </a></li>
                    <li class="list-group-item"><a href="http://github.com/higebu"><i
                            class="fa fa-github-square fa-lg"></i> github
                    </a></li>
                  </ul>
                </li>



                <li class="list-group-item"><a href="https://www.higebu.com/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                    <ul class="list-group" id="tags">
                        <li class="list-group-item tag-1">
                            <a href="https://www.higebu.com/tag/docker.html">
                                docker
                            </a>
                        </li>
                        <li class="list-group-item tag-1">
                            <a href="https://www.higebu.com/tag/vmware.html">
                                vmware
                            </a>
                        </li>
                        <li class="list-group-item tag-1">
                            <a href="https://www.higebu.com/tag/vyos.html">
                                vyos
                            </a>
                        </li>
                        <li class="list-group-item tag-1">
                            <a href="https://www.higebu.com/tag/vyatta.html">
                                vyatta
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="https://www.higebu.com/tag/conference.html">
                                conference
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="https://www.higebu.com/tag/packer.html">
                                packer
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="https://www.higebu.com/tag/vagrant.html">
                                vagrant
                            </a>
                        </li>
                        <li class="list-group-item tag-3">
                            <a href="https://www.higebu.com/tag/zabbix.html">
                                zabbix
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="https://www.higebu.com/tag/niftycloud.html">
                                niftycloud
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="https://www.higebu.com/tag/virtualbox.html">
                                virtualbox
                            </a>
                        </li>
                    </ul>
                </li>    

    <li class="list-group-item"><h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
        <div id="gh_repos">
            <ul class="list-group" id="github"></ul>
        </div>
    </li>
	<li class="list-group-item">
		<h4><i class="fa fa-github-alt fa-lg"></i><span class="icon-label">Coderwall Badges</span></h4>
		<div id="coderwall_badges"></div>
		<a href="http://coderwall.com/higebu">@higebu</a> on coderwall
	</li>
    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://getpelican.com/" target="_blank">
                Pelican
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://python.org/" target="_blank">
                Python.org
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://jinja.pocoo.org/" target="_blank">
                Jinja2
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://www.vyos-users.jp/" target="_blank">
                vyos-users.jp
            </a>
        </li>
      </ul>
    </li>

        </ul>
    </section>

</aside>        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2019 Yuya Kusakabe
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://code.jquery.com/jquery.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://www.higebu.com/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://www.higebu.com/theme/js/respond.min.js"></script>

    <script type="text/javascript">
	$(document).ready(function(){
		$.getJSON("https://api.github.com/search/repositories?q=user:higebu+fork:false&sort=stars&order=desc", function(data){
			for(var i = 0; i < data.items.length ; i++){
				if (i > 10 - 1) {
					break;
				}
				var repo = data.items[i];
				var repo_tag = '<li class="list-group-item"><a href="'+repo.html_url+'">'+repo.name+'</a> <i class="fa fa-star" aria-hidden="true"></i> '+repo.stargazers_count+' <i class="fa fa-code-fork" aria-hidden="true"></i> '+repo.forks_count+'<p><small>'+(repo.description||'')+'</small></p></li>';
				$("#github").append(repo_tag);
			}
		});
	});
    </script>

	<script type="text/javascript">
	$(document).ready(function(){
		$.getJSON("https://coderwall.com/higebu.json?callback=?", function(data){
			for(var i = 0; i < data.user.badges.length ; i++){
				var badge = data.user.badges[i];
				var badge_tag = $("<img />");
				badge_tag.attr("src",badge.badge);
				badge_tag.attr("title", badge.description);
				badge_tag.attr("alt", badge.name);
				badge_tag.css("width","50%");
				$("#coderwall_badges").append(badge_tag);
			}
		});
	});
	</script>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'higeblog'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-18631726-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();

    </script>
</body>
</html>